<p class="description">
  <%= t('intouch.project.settings.issue_update.telegram_groups.description') %>
</p>

<div>
  <%= t('intouch.project.settings.common.copy_settings_from_tab') %>
  <%= select_tag 'r', options_for_select(Intouch.available_recipients_without('telegram_groups').collect{ |r| [l("intouch.recipient.#{r}"), r] }) %>
  <%= button_tag t('intouch.project.settings.common.copy'), class: 'copySettingsFromOtherTab' %>
</div>

<% TelegramGroupChat.find_each do |telegram_group| %>
  <h4><%= telegram_group.title %></h4>
  <%= check_box_tag "intouch_settings[telegram_settings][groups][#{telegram_group.id}][only_unassigned]", '1',
                    settings_source.telegram_settings.try(:[], 'groups').try(:[], telegram_group.id.to_s).
                        try(:[], 'only_unassigned'),
                    id: "telegram_groups_#{telegram_group.id}_only_unassigned"
  %>
  <%= label_tag "telegram_groups_#{telegram_group.id}_only_unassigned", 'Только неназначенные' %>

  <%= check_box_tag "intouch_settings[telegram_settings][groups][#{telegram_group.id}][anytime]", '1',
                    settings_source.telegram_settings.try(:[], 'groups').try(:[], telegram_group.id.to_s).
                        try(:[], 'anytime'),
                    id: "telegram_groups_#{telegram_group.id}_anytime"
  %>
  <%= label_tag "telegram_groups_#{telegram_group.id}_anytime", 'Круглосуточно и без выходных' %>
  <table>
    <thead>
    <tr>
      <th><%= t('field_status') %> \ <%= t('field_priority') %></th>
      <% IssuePriority.order(:position).each do |priority| %>
        <th><%= priority.name %></th>
      <% end %>
    </tr>
    </thead>
    <tbody>
    <% IssueStatus.order(:position).each do |status| %>
      <tr>
        <th><%= status.name %></th>
        <% IssuePriority.order(:position).each do |priority| %>

          <td>
            <%= check_box_tag "intouch_settings[telegram_settings][groups][#{telegram_group.id}][#{status.id}][]", priority.id,
                              settings_source.telegram_settings.try(:[], 'groups').try(:[], telegram_group.id.to_s).
                                  try(:[], status.id.to_s).try(:include?, priority.id.to_s),
                                  class: "telegram_#{status.id}_#{priority.id}" %>
          </td>

        <% end %>
      </tr>


    <% end %>
    </tbody>
  </table>
<% end %>
